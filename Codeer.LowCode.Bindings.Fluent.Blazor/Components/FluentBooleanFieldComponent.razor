@using Codeer.LowCode.Bindings.Fluent.Blazor.Extensions
@using Codeer.LowCode.Blazor.Repository.Design
@using Codeer.LowCode.Blazor.OperatingModel
@using Codeer.LowCode.Bindings.Fluent.Blazor.Internal.Components
@inherits FluentFieldComponentBase<BooleanField, FluentBooleanFieldDesign>

@if (Field.ModuleLayoutType == ModuleLayoutType.List && Field.IsViewOnly) {
  <FluentLabel class="d-block py-2">
    @ViewOnlyValue
  </FluentLabel>
} else {
  if (Field.Design.UIType == BooleanUIType.CheckBox) {
    <FluentCheckbox Id="@WebElementId.DomSafeString()" @bind-Value:get="@IsChecked" @bind-Value:set="@OnChange" Disabled="@(IsDisabled || IsViewMode)" Label="@Label" />
  } else if (Field.Design.UIType == BooleanUIType.Switch) {
    <FluentSwitch Id="@WebElementId.DomSafeString()" @bind-Value:get="@IsChecked" @bind-Value:set="@OnChange" Disabled="@(IsDisabled || IsViewMode)" Label="@Label" />
  } else if (Field.Design.UIType == BooleanUIType.ToggleButton) {
    <InternalFluentToggleButton Id="@WebElementId.DomSafeString()" @bind-Value:get="@IsChecked" @bind-Value:set="@OnChange" Disabled="@(IsDisabled || IsViewMode)" Label="@Label" />
  }
}

@code {
  private bool IsDisabled => Field.IsEnabled == false;
  private bool IsViewMode => Field.IsViewOnly;
  private bool IsChecked => Field.Value == true;
  private string? Label => (Field.ModuleLayoutType == ModuleLayoutType.List && Field.Design.UIType != BooleanUIType.ToggleButton) ? string.Empty : Field.Services.AppInfoService.Localize(Field.Design.Text);

  private async Task OnChange(bool isChecked) {
    await Field.SetValueAsync(isChecked);
  }

  private object? ViewOnlyValue
  {
    get
    {
      if (Field.Services.AppInfoService.IsDesignMode) return "Boolean";
      if (Field.Value == null) return null;
      if (Field.Value == true)
      {
        return string.IsNullOrEmpty(Field.Design.TrueText) ? true : Field.Services.AppInfoService.Localize(Field.Design.TrueText);
      }
      else
      {
        return string.IsNullOrEmpty(Field.Design.FalseText) ? false : Field.Services.AppInfoService.Localize(Field.Design.FalseText);
      }
    }
  }

}